import{j as e}from"./app-B2S3Wz0d.js";import{r as t,a as i,H as X,d as Y}from"./inertia-Clk-cdek.js";import{T as Z}from"./TeacherLayout-DasbyfBQ.js";import{l as T,D as ee,x as se,z as te,ap as ae,K as re,m as le}from"./heroicons-CTwCrMww.js";import"./vendor-DNWpyu2A.js";/* empty css            */import"./Footer-C9OBh2Gh.js";import"./ErrorBoundary-Ctj5hp_u.js";import"./menu-BcEDE3vj.js";import"./portal-CZK08gWH.js";import"./transition-Cw_pkg33.js";function he({grades:v,academicYear:I}){const[a,R]=t.useState(""),[d,k]=t.useState(""),[l,U]=t.useState(""),[b,N]=t.useState([]),[g,_]=t.useState([]),[S,h]=t.useState({}),[G,C]=t.useState([]),[A,$]=t.useState([]),[q,M]=t.useState(!1),[f,E]=t.useState(!1),[H,y]=t.useState(!1),[L,j]=t.useState(!1),[P,w]=t.useState(!1),[z,D]=t.useState(null),[c,x]=t.useState({name:"",total_marks:10,assessment_type_id:"",description:""}),[n,p]=t.useState({id:null,name:"",total_marks:10,assessment_type_id:"",description:""}),F=v.find(s=>s.id===parseInt(a));F?.sections.find(s=>s.id===parseInt(d)),t.useEffect(()=>{a?i.get(route("teacher.assessments-simple.subjects-for-class"),{params:{grade_id:a}}).then(s=>C(s.data.subjects||[])):C([])},[a]),t.useEffect(()=>{a&&l&&i.get(route("teacher.assessments-simple.types-for-class"),{params:{grade_id:a,subject_id:l}}).then(s=>$(s.data))},[a,l]),t.useEffect(()=>{a&&d&&l?m():(N([]),_([]),h({}))},[a,d,l]);const m=async()=>{M(!0);try{const s=await i.get(route("teacher.assessments.unified-data"),{params:{grade_id:a,section_id:d,subject_id:l}});N(s.data.students),_(s.data.assessments),h(s.data.marks)}catch(s){console.error(s),alert("Failed to load data.")}finally{M(!1)}},B=(s,r,o)=>{h(u=>({...u,[s]:{...u[s]||{},[r]:o}}))},K=async()=>{E(!0);try{await Y.post(route("teacher.declare-result.store"),{grade_id:a,section_id:d,subject_id:l,marks:S,is_finalized:!1},{preserveScroll:!0,onSuccess:()=>alert("Marks Saved Successfully!")})}catch{alert("Error saving marks.")}finally{E(!1)}},J=async s=>{if(s.preventDefault(),!a||!d||!l){alert("Please select Grade, Section, and Subject first.");return}try{const r=await i.post(route("teacher.assessments.store"),{grade_id:a,section_id:d,subject_id:l,name:c.name,max_score:c.total_marks,assessment_type_id:c.assessment_type_id||null,description:c.description});console.log("Assessment created:",r.data),y(!1),x({name:"",total_marks:10,assessment_type_id:"",description:""}),m(),alert("Assessment created successfully!")}catch(r){console.error("Error creating assessment:",r);const o=r.response?.data?.message||r.response?.data?.error||"Failed to create assessment. Please try again.";alert(o)}},O=s=>{p({id:s.id,name:s.name,total_marks:s.max_score,assessment_type_id:s.assessment_type_id||"",description:s.description||""}),j(!0)},Q=async s=>{s.preventDefault();try{await i.put(route("teacher.assessments.update",n.id),{name:n.name,max_score:n.total_marks,assessment_type_id:n.assessment_type_id||null,description:n.description}),j(!1),m(),alert("Assessment updated successfully!")}catch(r){console.error(r),alert("Failed to update assessment.")}},V=s=>{D(s),w(!0)},W=async()=>{try{await i.delete(route("teacher.assessments.destroy",z.id)),w(!1),D(null),m(),alert("Assessment deleted successfully!")}catch(s){console.error(s),alert("Failed to delete assessment.")}};return e.jsxs(Z,{children:[e.jsx(X,{title:"Unified Assessment Manager"}),e.jsxs("div",{className:"h-[calc(100vh-65px)] flex flex-col pt-6 px-4 max-w-[100vw] overflow-hidden",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end justify-between gap-6 mb-6 flex-shrink-0",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-black text-gray-900 tracking-tight uppercase",children:["Assessment ",e.jsx("span",{className:"text-blue-600",children:"Manager"})]}),e.jsxs("p",{className:"text-xs font-bold text-gray-400 uppercase tracking-widest mt-1",children:[I?.name," • Unified Interface"]})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-white p-2 rounded-2xl border border-gray-100 shadow-sm",children:[e.jsx("div",{className:"relative group",children:e.jsxs("select",{value:a,onChange:s=>{R(s.target.value),k("")},className:"pl-4 pr-10 py-2.5 bg-gray-50 border border-transparent hover:border-blue-100 rounded-xl text-xs font-black uppercase tracking-wide cursor-pointer focus:ring-0 w-40 transition-all",children:[e.jsx("option",{value:"",children:"Grade..."}),v.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})}),e.jsx("div",{className:"w-px h-8 bg-gray-100"}),e.jsx("div",{className:"relative group",children:e.jsxs("select",{value:d,onChange:s=>k(s.target.value),disabled:!a,className:"pl-4 pr-10 py-2.5 bg-gray-50 border border-transparent hover:border-blue-100 rounded-xl text-xs font-black uppercase tracking-wide cursor-pointer focus:ring-0 w-40 transition-all disabled:opacity-50",children:[e.jsx("option",{value:"",children:"Section..."}),F?.sections.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})}),e.jsx("div",{className:"w-px h-8 bg-gray-100"}),e.jsx("div",{className:"relative group",children:e.jsxs("select",{value:l,onChange:s=>U(s.target.value),disabled:!d,className:"pl-4 pr-10 py-2.5 bg-gray-50 border border-transparent hover:border-blue-100 rounded-xl text-xs font-black uppercase tracking-wide cursor-pointer focus:ring-0 w-48 transition-all disabled:opacity-50",children:[e.jsx("option",{value:"",children:"Subject..."}),G.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})})]})]}),q?e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx(T,{className:"w-8 h-8 text-blue-600 animate-spin"})}):l?e.jsxs("div",{className:"flex-1 flex flex-col min-h-0 bg-white rounded-t-3xl border border-gray-200 shadow-xl shadow-gray-100/50 overflow-hidden relative",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-100 flex items-center justify-between bg-white/80 backdrop-blur-sm z-20",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-[10px] font-black uppercase tracking-widest text-gray-400",children:[b.length," Students"]}),e.jsx("span",{className:"text-gray-300",children:"•"}),e.jsxs("span",{className:"text-[10px] font-black uppercase tracking-widest text-gray-400",children:[g.length," Assessments"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>y(!0),className:"px-4 py-2 bg-gray-900 hover:bg-black text-white rounded-lg text-[10px] font-black uppercase tracking-widest transition-all shadow-lg shadow-gray-200 flex items-center gap-2 transform active:scale-95",children:[e.jsx(se,{className:"w-4 h-4"}),"New Assessment"]}),e.jsxs("button",{onClick:K,disabled:f,className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-[10px] font-black uppercase tracking-widest transition-all shadow-lg shadow-blue-200 flex items-center gap-2 transform active:scale-95 disabled:opacity-70 disabled:cursor-not-allowed",children:[f?e.jsx(T,{className:"w-4 h-4 animate-spin"}):e.jsx(te,{className:"w-4 h-4"}),f?"Saving...":"Save All Marks"]})]})]}),e.jsxs("div",{className:"flex-1 overflow-auto custom-scrollbar",children:[e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-gray-50/50 sticky top-0 z-10 backdrop-blur-md",children:e.jsxs("tr",{children:[e.jsx("th",{className:"sticky left-0 bg-gray-50 z-20 px-6 py-4 text-[10px] font-black text-gray-400 uppercase tracking-widest border-b border-r border-gray-200 shadow-[4px_0_10px_-4px_rgba(0,0,0,0.05)] w-60",children:"Student"}),g.map(s=>e.jsx("th",{className:"px-4 py-4 min-w-[160px] border-b border-gray-100 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] font-black text-gray-900 uppercase tracking-tight truncate max-w-[100px]",title:s.name,children:s.name}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>O(s),className:"p-1 hover:bg-blue-100 rounded text-blue-600 transition-colors",title:"Edit",children:e.jsx(ae,{className:"w-3 h-3"})}),e.jsx("button",{onClick:()=>V(s),className:"p-1 hover:bg-red-100 rounded text-red-600 transition-colors",title:"Delete",children:e.jsx(re,{className:"w-3 h-3"})})]})]}),e.jsxs("span",{className:"text-[9px] font-bold text-gray-400 uppercase tracking-wider bg-gray-100 px-2 py-0.5 rounded-md",children:["Max: ",s.max_score]})]})},s.id)),e.jsx("th",{className:"w-full border-b border-gray-100"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-50",children:b.map(s=>e.jsxs("tr",{className:"hover:bg-blue-50/5 transition-colors group",children:[e.jsx("td",{className:"sticky left-0 bg-white group-hover:bg-blue-50/20 z-10 px-6 py-3 border-r border-gray-100 shadow-[4px_0_10px_-4px_rgba(0,0,0,0.05)] transition-colors",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-[10px] font-black text-gray-500 uppercase",children:s.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-bold text-gray-900 uppercase",children:s.name}),e.jsx("div",{className:"text-[9px] font-bold text-gray-400",children:s.student_id})]})]})}),g.map(r=>{const o=S[s.id]?.[r.id]??"";return e.jsx("td",{className:"p-2 text-center border-r border-gray-50 last:border-0",children:e.jsx("input",{type:"number",min:"0",max:r.max_score,step:"0.1",value:o,onChange:u=>B(s.id,r.id,u.target.value),className:"w-20 h-9 text-center bg-gray-50 border-transparent focus:bg-white focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 rounded-lg text-sm font-bold text-gray-900 transition-all placeholder-gray-300",placeholder:"-"})},r.id)}),e.jsx("td",{})]},s.id))})]}),b.length===0&&e.jsx("div",{className:"p-12 text-center text-gray-400 italic text-sm",children:"No students found in this section."})]})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-gray-400 border-2 border-dashed border-gray-200 rounded-3xl m-4",children:[e.jsx(ee,{className:"w-12 h-12 mb-4 text-gray-300"}),e.jsx("p",{className:"text-sm font-bold uppercase tracking-widest",children:"Select Grade, Section & Subject to Begin"})]})]}),H&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-[2rem] p-8 w-full max-w-md shadow-2xl animate-in zoom-in-95 duration-200",children:[e.jsx("h2",{className:"text-2xl font-black text-gray-900 uppercase tracking-tight mb-6",children:"New Assessment"}),e.jsxs("form",{onSubmit:J,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black uppercase tracking-widest text-gray-400 mb-2",children:"Name"}),e.jsx("input",{type:"text",required:!0,value:c.name,onChange:s=>x({...c,name:s.target.value}),className:"w-full px-4 py-3 bg-gray-50 border-transparent focus:bg-white focus:border-blue-500 rounded-xl text-sm font-bold",placeholder:"e.g. Unit Test 3"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black uppercase tracking-widest text-gray-400 mb-2",children:"Max Marks"}),e.jsx("input",{type:"number",required:!0,min:"1",value:c.total_marks,onChange:s=>x({...c,total_marks:s.target.value}),className:"w-full px-4 py-3 bg-gray-50 border-transparent focus:bg-white focus:border-blue-500 rounded-xl text-sm font-bold"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black uppercase tracking-widest text-gray-400 mb-2",children:"Type"}),e.jsxs("select",{value:c.assessment_type_id,onChange:s=>x({...c,assessment_type_id:s.target.value}),className:"w-full px-4 py-3 bg-gray-50 border-transparent focus:bg-white focus:border-blue-500 rounded-xl text-xs font-bold",children:[e.jsx("option",{value:"",children:"(None)"}),A.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>y(!1),className:"px-6 py-3 bg-gray-100 hover:bg-gray-200 text-gray-600 rounded-xl text-[10px] font-black uppercase tracking-widest transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-8 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl text-[10px] font-black uppercase tracking-widest transition-colors shadow-lg shadow-blue-200",children:"Create"})]})]})]})}),L&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-[2rem] p-8 w-full max-w-md shadow-2xl animate-in zoom-in-95 duration-200",children:[e.jsx("h2",{className:"text-2xl font-black text-gray-900 uppercase tracking-tight mb-6",children:"Edit Assessment"}),e.jsxs("form",{onSubmit:Q,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black uppercase tracking-widest text-gray-400 mb-2",children:"Name"}),e.jsx("input",{type:"text",required:!0,value:n.name,onChange:s=>p({...n,name:s.target.value}),className:"w-full px-4 py-3 bg-gray-50 border-transparent focus:bg-white focus:border-blue-500 rounded-xl text-sm font-bold",placeholder:"e.g. Unit Test 3"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black uppercase tracking-widest text-gray-400 mb-2",children:"Max Marks"}),e.jsx("input",{type:"number",required:!0,min:"1",value:n.total_marks,onChange:s=>p({...n,total_marks:s.target.value}),className:"w-full px-4 py-3 bg-gray-50 border-transparent focus:bg-white focus:border-blue-500 rounded-xl text-sm font-bold"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black uppercase tracking-widest text-gray-400 mb-2",children:"Type"}),e.jsxs("select",{value:n.assessment_type_id,onChange:s=>p({...n,assessment_type_id:s.target.value}),className:"w-full px-4 py-3 bg-gray-50 border-transparent focus:bg-white focus:border-blue-500 rounded-xl text-xs font-bold",children:[e.jsx("option",{value:"",children:"(None)"}),A.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>j(!1),className:"px-6 py-3 bg-gray-100 hover:bg-gray-200 text-gray-600 rounded-xl text-[10px] font-black uppercase tracking-widest transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-8 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl text-[10px] font-black uppercase tracking-widest transition-colors shadow-lg shadow-blue-200",children:"Update"})]})]})]})}),P&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-[2rem] p-8 w-full max-w-md shadow-2xl animate-in zoom-in-95 duration-200",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("div",{className:"p-3 bg-red-100 rounded-xl",children:e.jsx(le,{className:"w-6 h-6 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-black text-gray-900 uppercase tracking-tight",children:"Delete Assessment"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"This action cannot be undone"})]})]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-6",children:['Are you sure you want to delete "',e.jsx("span",{className:"font-bold",children:z?.name}),'"? All associated marks will also be deleted.']}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:()=>w(!1),className:"px-6 py-3 bg-gray-100 hover:bg-gray-200 text-gray-600 rounded-xl text-[10px] font-black uppercase tracking-widest transition-colors",children:"Cancel"}),e.jsx("button",{onClick:W,className:"px-8 py-3 bg-red-600 hover:bg-red-700 text-white rounded-xl text-[10px] font-black uppercase tracking-widest transition-colors shadow-lg shadow-red-200",children:"Delete"})]})]})})]})}export{he as default};
